<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Transformers | Zeus Project</title>
        <link rel="icon" href="../../favicon.ico" />
        <link
            href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Outfit:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <link href="../../assets/css/styles.css" rel="stylesheet" />
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css"
        />
        <style>
            .md-content h1,
            .md-content h2,
            .md-content h3,
            .md-content h4 {
                color: #a68a6d;
                font-family: "Libre Baskerville", serif;
            }
            .md-content p,
            .md-content ul,
            .md-content ol,
            .md-content blockquote {
                color: #4a3e31;
                font-family: "Outfit", sans-serif;
            }
            .md-content img {
                max-width: 100%;
                height: auto;
                border-radius: 1rem;
                display: block;
                margin: 1.5em auto;
            }
            .project-card {
                background: #fff;
                border-radius: 1.25rem;
                border: 1px solid #f0e6d2;
                padding: 1rem;
                margin-bottom: 1.5rem;
            }
            .markdown-body p {
                margin-bottom: 1rem;
                line-height: 1.7;
            }

            .markdown-body h1,
            .markdown-body h2,
            .markdown-body h3 {
                margin-top: 2rem;
                margin-bottom: 1rem;
            }

            .markdown-body li {
                margin-bottom: 0.5rem;
            }

            .markdown-body code {
                background-color: #f6f8fa;
                padding: 2px 4px;
                border-radius: 4px;
            }
        </style>
    </head>
    <body class="cream-bg min-h-screen text-[#3B3025] flex flex-col">
        <header
            class="flex items-center justify-between px-4 sm:px-6 py-4 border-b border-[#F0E6D2] bg-[#FAF3E0]"
        >
            <div class="text-xl sm:text-2xl font-bold tracking-wide serif text-[#A68A6D]">
                The Zeus Project
            </div>
            <nav>
                <ul class="flex space-x-3 sm:space-x-6 text-sm sm:text-lg outfit font-semibold">
                    <li><a href="/../../index.html" class="hover:text-[#A68A6D]">Home</a></li>
                    <li><a href="/pages/curriculum.html" class="hover:text-[#A68A6D]">Curriculum</a></li>
                    <li><a href="/pages/groups.html" class="hover:text-[#A68A6D]">Groups</a></li>
                    <li><a href="/pages/about.html" class="hover:text-[#A68A6D]">About</a></li>
                </ul>
            </nav>
        </header>

        <main class="max-w-7xl mx-auto px-4 py-8 sm:py-16 flex-grow grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
            <div class="lg:col-span-2">
                <section class="text-center mb-8 sm:mb-12">
                    <h1 id="lesson-title" class="text-2xl sm:text-4xl md:text-5xl font-extrabold mb-4 text-[#b1a091] serif tracking-wider leading-relaxed">Transformers</h1>
                    <p id="lesson-subtitle" class="text-base sm:text-lg md:text-xl text-[#4A3E31] mb-6 sm:mb-8 outfit px-2">An overview of the Transformer architecture and how it powers modern LLMs.</p>
                    <p class="text-sm sm:text-md text-[#4A3E31] mb-6 sm:mb-8 outfit">by <span id="contributor-name">kanishk</span></p>
                    <button class="btn text-sm sm:text-base" onclick="loadLesson()">Reload Lesson</button>
                </section>

                <section class="card p-4 sm:p-8 mb-8 sm:mb-12 fadein">
                    <div id="lesson-content" class="md-content markdown-body"></div>
                </section>
            </div>

            <aside id="projects-section" class="lg:col-span-1">
            </aside>
        </main>

        <section class="text-center mb-4">
            <h3 class="text-base sm:text-lg font-bold mb-4 text-[#A68A6D] serif">Share this article</h3>
            <div class="flex justify-center space-x-3 sm:space-x-4">
                <a href="#" id="share-twitter" class="social-share" aria-label="Share on Twitter">Twitter</a>
                <a href="#" id="share-linkedin" class="social-share" aria-label="Share on LinkedIn">LinkedIn</a>
            </div>
        </section>

        <footer class="flex flex-col md:flex-row justify-between items-center py-4 sm:py-6 px-4 border-t border-[#F0E6D2] bg-[#FAF3E0] text-xs serif">
            <div class="mb-2 md:mb-0 text-[#A68A6D]">&copy; 2025 The Zeus Project</div>
            <div class="flex space-x-3 sm:space-x-4">
                <a href="https://github.com/thezeusproject/thezeusproject.github.io" class="text-[#4A3E31] hover:text-[#A68A6D]">GitHub</a>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>
            const LESSON_ID = "transformers";
            const MD_PATH = "../../content/blog/Transfomer.md";
            const PROJECTS_PATH = "../../content/projects/Transformer-implementation.md";

            document.addEventListener("DOMContentLoaded", () => {
                loadLesson();
                setupTOC();
                setupSocialShare();
                loadProjects();
            });

            function loadLesson() {
                const lessonContentEl = document.getElementById("lesson-content");
                const lessonTitleEl = document.getElementById("lesson-title");
                const lessonSubtitleEl = document.getElementById("lesson-subtitle");
                const contributorNameEl = document.getElementById("contributor-name");

                fetch(encodeURI(MD_PATH))
                    .then((response) => (response.ok ? response.text() : Promise.reject("File not found")))
                    .then((text) => {
                        const frontmatterRegex = /---\s*([\s\S]*?)\s*---/;
                        const match = text.match(frontmatterRegex);

                        let content = text;
                        if (match) {
                            const frontmatter = match[1];
                            content = text.substring(match.index + match[0].length);
                            const metadata = {};
                                            frontmatter.split("\n").forEach((line) => {
                                                if (line.includes(":")) {
                                                    const [key, ...valueParts] = line.split(":");
                                                    // Join remainder and trim
                                                    let val = valueParts.join(":").trim();
                                                    // Remove surrounding single or double quotes if present
                                                    val = val.replace(/^"(.*)"$/s, "$1").replace(/^'(.*)'$/s, "$1");
                                                    metadata[key.trim()] = val;
                                                }
                                            });
                            lessonTitleEl.innerText = metadata.title || "Transformers";
                            lessonSubtitleEl.innerText = metadata.subtitle || "An overview of the Transformer architecture.";
                            contributorNameEl.innerText = metadata.author || "kanishk";
                        }

                        marked.setOptions({ breaks: true });
                        lessonContentEl.innerHTML = marked.parse(content);

                        renderMathInElement(lessonContentEl, {
                            delimiters: [
                                { left: "$$", right: "$$", display: true },
                                { left: "$", right: "$", display: false },
                                { left: "\\(", right: "\\)", display: false },
                                { left: "\\[", right: "\\]", display: true },
                            ],
                        });
                        hljs.highlightAll();
                        generateTOC();

                        setTimeout(() => {
                            const fade = document.querySelector('.fadein');
                            if (fade) fade.classList.add('visible');
                        }, 100);
                    })
                    .catch((error) => {
                        console.error("Error fetching the lesson content:", error);
                        lessonContentEl.innerHTML = `<p class="text-red-500">Error loading lesson. Please try again later.</p>`;
                    });
            }

            function setupSocialShare() {
                const url = window.location.href;
                const text = `Check out this lesson on ${document.title}`;
                document.getElementById("share-twitter").href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
                document.getElementById("share-linkedin").href = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;
            }

            function setupTOC() {
            }

            function generateTOC() {
            
            }

            function loadProjects() {
                const projectsSection = document.getElementById("projects-section");
                fetch(encodeURI(PROJECTS_PATH))
                    .then((response) => (response.ok ? response.text() : Promise.reject("File not found")))
                    .then((markdown) => {
                        const html = marked.parse(markdown, { gfm: true });
                        const projectContainer = document.createElement("div");
                        projectContainer.innerHTML = html;

                        const projectHTMLs = projectContainer.innerHTML.split("<hr>");

                        projectsSection.innerHTML = "";

                        projectHTMLs.forEach((projectHTML, projectIndex) => {
                            const projectCard = document.createElement("div");
                            projectCard.className = "project-card";
                                projectCard.innerHTML = `<div class="project-tasks markdown-body">${projectHTML}</div>`;
                            projectsSection.appendChild(projectCard);

                            const listItems = projectCard.querySelectorAll('.project-tasks li');
                            listItems.forEach((li, taskIndex) => {
                                const checkbox = li.querySelector('input[type="checkbox"]');
                                if (!checkbox) return;
                                const taskId = `${LESSON_ID}-project-${projectIndex}-task-${taskIndex}`;
                                if (localStorage.getItem(taskId) === 'true') checkbox.checked = true;
                                checkbox.addEventListener('change', () => {
                                    localStorage.setItem(taskId, checkbox.checked);
                                });
                            });
                        });
                    })
                    .catch((error) => {
                        console.error("Error fetching projects:", error);
                        projectsSection.innerHTML = "<p>No projects available for this lesson.</p>";
                    });
            }
        </script>
    </body>
</html>
